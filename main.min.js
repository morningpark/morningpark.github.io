var UnitIcon=function(t){function e(e){return t.call(this),this.touchTime=0,this.istouch=!1,this.priceTxt=new egret.TextField,this.touchPointX=0,this.touchPointY=0,"lock"==e?(this.icon=Utils.createBitmapByName("unitLock"),void this.addChild(this.icon)):(this.res=e,this.icon=Utils.createBitmapByName(this.res),this.addChild(this.icon),this.icon.x=-10,this.icon.y=-14,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchHandle,this),void this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touch,this))}__extends(e,t);var i=(__define,e),s=i.prototype;return s.touchHandle=function(t){this.istouch=!0,SoundManager.playEffect("select"),this.gold>=this.price&&(this.touchPointX=t.stageX,this.touchPointY=t.stageY,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touch,this)},s.mouseMove=function(t){this.istouch=!1,this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseEnd,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touch,this),this.icon.x=this.icon.x+(t.stageX-this.touchPointX),this.icon.y=this.icon.y+(t.stageY-this.touchPointY),GuankaBase.instance.shape.alpha=.2,this.touchPointX=t.stageX,this.touchPointY=t.stageY,GuankaBase.instance.guankaUI.boardSp.visible=!1},s.mouseEnd=function(t){},s.touch=function(t){},s.selectIcon=function(t){this.icon.y=-24,GuankaBase.instance.shape.alpha=.2,GuankaBase.instance.guankaUI.boardSp.visible=!1},s.reselectIcon=function(){Group.disposeIcon()},s.deselectIcon=function(){},s.setMbheight=function(t){this.mb.height=t},s.setAlpha=function(t){this.balance.height=t},s.onEnterFrame=function(t){},e}(egret.Sprite);egret.registerClass(UnitIcon,"UnitIcon");var UnitTool=function(t){function e(){t.call(this),this.iconArr=[],this.cacheAsBitmap=!0,this.createTools()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createTools=function(){this.addIcon("skill1_png",0,0),this.addIcon("skill2_png",12,-65),this.addIcon("skill3_png",85,12)},s.addIcon=function(t,e,i){this.icon=new UnitIcon(t),this.icon.x=e,this.icon.y=i,this.icon.touchEnabled=!0,this.icon.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.iconClickHandle,this),this.addChild(this.icon),"lock"!=t&&this.iconArr.push(this.icon)},s.iconClickHandle=function(t){var e=t.currentTarget.className,i=t.currentTarget.price;return 0==t.currentTarget.is?void(t.currentTarget.is=!0):void(this.gold>=i&&this.dispatchEvent(new ToolEvent(ToolEvent.BUILD_START,e,i)))},s.onEnterFrame=function(t){for(var e=0;e<this.iconArr.length;e++)this.iconArr[e].onEnterFrame(t)},e}(egret.Sprite);egret.registerClass(UnitTool,"UnitTool");var GameSetting=function(){function t(){}var e=(__define,t);e.prototype;return t.swid=640,t.shei=480,t.goldStar=0,t}();egret.registerClass(GameSetting,"GameSetting");var GuanKaConfig=function(){function t(){}var e=(__define,t);e.prototype;return t.getData=function(){return t.data},t.guankaData=["guanka01load","guanka02load","guanka03load","guanka04load","guanka05load","guanka06load","guanka03load","guanka04load","guanka01load","guanka02load","guanka03load","guanka04load"],t.data=[{xpos:105,ypos:388,ispass:!1,wujin:0,name:"占山为王",story:"九州动荡，叛乱四起，你本事不行但梦想远大，所以带着手下来清剿越辽山上的土匪，准备搞一个大新闻"}],t}();egret.registerClass(GuanKaConfig,"GuanKaConfig");var HeroConfig=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(HeroConfig,"HeroConfig");var StorageSetting=function(){function t(){}var e=(__define,t);e.prototype;return t.getItem=function(t){var e=egret.localStorage.getItem(t);return null==e&&(e="0"),e},t.loadConfig=function(){var t,e,i;for(i=GuanKaConfig.data.length,e=0;i>e;e++)t="1",egret.localStorage.setItem("ispass"+e,t),GuanKaConfig.data[e].ispass=Boolean(Number(t)),t=egret.localStorage.getItem("wujin"+e),null==t&&(t="0",egret.localStorage.setItem("wujin"+e,t)),GuanKaConfig.data[e].wujin=Number(t);for(e=0;4>e;e++)for(var s=0;3>s;s++)t="1",egret.localStorage.setItem(TowerLevel.towNameArr[e]+TowerLevel.keyNameArr[s],t),0==e?TowerLevel.AttackTower[TowerLevel.keyNameArr[s]]=Boolean(Number(t)):1==e?TowerLevel.ShieldTower[TowerLevel.keyNameArr[s]]=Boolean(Number(t)):2==e?TowerLevel.MagicTower[TowerLevel.keyNameArr[s]]=Boolean(Number(t)):3==e&&(TowerLevel.ExploTower[TowerLevel.keyNameArr[s]]=Boolean(Number(t)));t=egret.localStorage.getItem("goldStar"),null==t&&(t="0",egret.localStorage.setItem("goldStar",t)),GameSetting.goldStar=Number(t)},t.setGuankaPass=function(t){egret.localStorage.setItem("ispass"+t,"1"),GuanKaConfig.data[t].ispass=!0},t.setGuankaWujin=function(t,e){var i=egret.localStorage.getItem("wujin"+t);e<=Number(i)||(egret.localStorage.setItem("wujin"+t,String(e)),GuanKaConfig.data[t].wujin=e)},t.setTowerUpgrade=function(t){for(var e=0;4>e;e++)egret.localStorage.setItem(TowerLevel.towNameArr[e]+TowerLevel.keyNameArr[t],"1"),0==e?TowerLevel.AttackTower[TowerLevel.keyNameArr[t]]=!0:1==e?TowerLevel.ShieldTower[TowerLevel.keyNameArr[t]]=!0:2==e?TowerLevel.MagicTower[TowerLevel.keyNameArr[t]]=!0:3==e&&(TowerLevel.ExploTower[TowerLevel.keyNameArr[t]]=!0)},t}();egret.registerClass(StorageSetting,"StorageSetting");var TowerLevel=function(){function t(){}var e=(__define,t);e.prototype;return t.towNameArr=["ArrowTower-","ShieldTower-","MagicTower-","ExploTower-"],t.keyNameArr=["lv01-lv02","lv02-lv03_1","lv02-lv03_2"],t.AttackTower={"lv01-lv02":!1,"lv02-lv03_1":!1,"lv02-lv03_2":!1},t.ShieldTower={"lv01-lv02":!1,"lv02-lv03_1":!1,"lv02-lv03_2":!1},t.MagicTower={"lv01-lv02":!1,"lv02-lv03_1":!1,"lv02-lv03_2":!1},t.ExploTower={"lv01-lv02":!1,"lv02-lv03_1":!1,"lv02-lv03_2":!1},t.soldierData={s01:{type:"human2-1-1",price:10,life:38,maxSpeed:.6,damage:38,fireDelay:500,suckBlood:0,specialType:13,value:1,attackType:1,label:"列卒",info:"战斗开始时额外召唤三个枪兵，召唤的枪兵到达终点给敌方造成3点伤害",tip:"到达终点给对方造成3点伤害",unitTip:"人族",min:50},s02:{type:"xinshe",price:20,life:440,maxSpeed:.7,damage:60,fireDelay:700,suckBlood:0,specialType:1,value:2,attackType:1,label:"信蛇",info:"对目标附近单位造成同等伤害",tip:"到达终点给对方造成20伤害",unitTip:"人族",min:70},s03:{type:"human2-3",price:20,life:200,maxSpeed:.6,damage:110,fireDelay:700,suckBlood:0,specialType:0,value:2,attackType:2,label:"鬼弓",info:"射程远，攻速快",tip:"到达终点给对方造成20伤害",unitTip:"人族",min:120},s04:{type:"jinwei",price:30,life:960,maxSpeed:.5,damage:120,fireDelay:1100,suckBlood:0,specialType:4,value:1,attackType:1,label:"近卫",info:"目标周围所有敌方单位均摊伤害",tip:"到达终点给对方造成30伤害",unitTip:"夸父",min:60},s05:{type:"s14",price:30,life:200,maxSpeed:.6,damage:96,fireDelay:1e3,suckBlood:0,specialType:14,value:3,attackType:3,label:"云影",info:"幻化一个拥有同等攻击力的幻象，任何伤害都会使幻象消失\n幻象到达终点不会造成伤害",tip:"到达终点给对方造成30伤害",unitTip:"魅",min:100},s06:{type:"s04",price:40,life:360,maxSpeed:.6,damage:136,fireDelay:800,suckBlood:0,specialType:8,value:3,attackType:3,label:"天光",info:"攻击使单位致盲，有20%几率攻击失效",tip:"到达终点给对方造成20伤害",unitTip:"魅",min:100},s07:{type:"human2-2",price:40,life:990,maxSpeed:.8,damage:137,fireDelay:800,suckBlood:0,specialType:2,value:.2,attackType:1,label:"铁浮屠",info:"每次攻击提升20%伤害",tip:"到达终点给对方造成40伤害",unitTip:"人族",min:80},s01_1:{type:"human2-1-1",price:4,life:50,maxSpeed:.6,damage:50,fireDelay:500,suckBlood:0,specialType:0,value:1,attackType:1,label:"列卒",info:"战斗开始时额外召唤两个枪兵",tip:"",unitTip:"人族",min:50},s05_1:{type:"s14",price:0,life:1,maxSpeed:.6,damage:96,fireDelay:1e3,suckBlood:0,specialType:0,value:3,attackType:3,label:"云影",info:"幻化一个拥有同等攻击力的幻象，任何伤害都会使幻象消失",tip:"",unitTip:"魅",min:100},myLord:{type:"ShieldTower03_2",life:3e3,maxSpeed:.6,damage:300,fireDelay:700,specialType:0,attackType:2,unitType:4},myTower:{type:"ArrowTower02",life:1e3,maxSpeed:.6,damage:150,fireDelay:700,specialType:0,attackType:2,unitType:4},enemyLord:{type:"ShieldTowerBlue03",life:8e3,maxSpeed:.6,damage:700,fireDelay:700,specialType:0,attackType:2,unitType:4},enemyTower:{type:"ArrowTowerBlue01",life:4e3,maxSpeed:.6,damage:300,fireDelay:700,specialType:0,attackType:2,unitType:4},gold:{res:"gold",price:120,life:0,damage:0,label:"军饷",info:"金铢每秒产量+1",tip:"",unitTip:"科技"},arrow:{res:"gj01",price:120,life:0,damage:0,label:"利箭",info:"提升所有箭塔伤害",tip:"",unitTip:"科技"},tower:{res:"life",price:120,life:0,damage:0,label:"天工",info:"提升所有箭塔生命值恢复速度",tip:"",unitTip:"科技"},SellTower:{className:"SellTower",res:"sell",price:0},LockTower:{className:"LockTower",res:"lock",price:0}},t}();egret.registerClass(TowerLevel,"TowerLevel");var Elements=function(t){function e(){t.call(this),this.targets=[],this.canClear=!1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onCreate=function(){},s.onDestroy=function(){this&&this.parent&&this.parent.removeChild(this)},s.move=function(){},s.onHit=function(){},s.onEnterFrame=function(t){},e}(egret.Sprite);egret.registerClass(Elements,"Elements");var LoadEvent=function(t){function e(e,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1),t.call(this,e,i,s)}__extends(e,t);var i=(__define,e);i.prototype;return e}(RES.ResourceEvent);egret.registerClass(LoadEvent,"LoadEvent");var MainEvent=function(t){function e(e,i,s,a){void 0===i&&(i=""),void 0===s&&(s=!1),void 0===a&&(a=!1),t.call(this,e,s,a),this._resName="",this._resName=i}__extends(e,t);var i=__define,s=e,a=s.prototype;return i(a,"resName",function(){return this._resName}),e.OPENLOADBAR="openloadbar",e.REMOVE="remove",e.LOADCOMP="loadcomp",e.PAUSE="pause",e.QUITGUANKA="quitguanka",e.TRYAGAIN="tryagain",e}(egret.Event);egret.registerClass(MainEvent,"MainEvent");var SoldEvent=function(t){function e(e,i,s,a,n){void 0===i&&(i=null),void 0===s&&(s=null),void 0===a&&(a=!1),void 0===n&&(n=!1),t.call(this,e,a,n),this._obj=i,this._arr=s}__extends(e,t);var i=__define,s=e,a=s.prototype;return i(a,"obj",function(){return this._obj}),i(a,"arr",function(){return this._arr}),e.SELECT="select",e.DESELECT="deselect",e.MOVE="move",e}(egret.Event);egret.registerClass(SoldEvent,"SoldEvent");var ToolEvent=function(t){function e(e,i,s,a,n){void 0===i&&(i=""),void 0===s&&(s=0),void 0===a&&(a=!1),void 0===n&&(n=!1),t.call(this,e,a,n),this._className="",this._price=0,this._className=i,this._price=s}__extends(e,t);var i=__define,s=e,a=s.prototype;return i(a,"className",function(){return this._className}),i(a,"price",function(){return this._price}),e.BUILD_START="build_start",e.BUILD_COMP="build_comp",e}(egret.Event);egret.registerClass(ToolEvent,"ToolEvent");var TowerEvent=function(t){function e(e,i,s,a){void 0===i&&(i=null),void 0===s&&(s=!1),void 0===a&&(a=!1),t.call(this,e,s,a),this._obj=i}__extends(e,t);var i=__define,s=e,a=s.prototype;return i(a,"obj",function(){return this._obj}),e.SHOWTOOL="showtool",e.HIDETOOL="hidetool",e}(egret.Event);egret.registerClass(TowerEvent,"TowerEvent");var stateType;!function(t){t[t.idleState=0]="idleState",t[t.moveState=1]="moveState",t[t.moveEndState=2]="moveEndState",t[t.fightState=3]="fightState",t[t.fightEndState=4]="fightEndState",t[t.deadState=5]="deadState",t[t.deadEndState=6]="deadEndState"}(stateType||(stateType={}));var StateMachine=function(){function t(t){this._obj=t}var e=__define,i=t,s=i.prototype;return s.changeState=function(t){this._curState=t},s.onEnterFrame=function(t){switch(this._curState){case stateType.idleState:this._obj.isIdle()&&this._obj.idling();break;case stateType.moveState:this._obj.isMove()&&this._obj.moving();break;case stateType.moveEndState:this._obj.movingEnd();break;case stateType.fightState:this._obj.isFighting()&&this._obj.fighting();break;case stateType.fightEndState:this._obj.fightingEnd();break;case stateType.deadState:this._obj.isDead()&&this._obj.dying();break;case stateType.deadEndState:this._obj.dyingEnd()}},e(s,"curState",function(){return this._curState}),t}();egret.registerClass(StateMachine,"StateMachine");var GuankaBase=function(t){function e(){t.call(this),this.otime=0,this.atime=0,this.stime=0,this.mtime=0,this.timeGo=0,this.touchPointX=0,this.touchPointY=0,this.sea=new egret.Sprite,this.brick=new egret.Sprite,this.mouseDown=!1,this.mouseDownTime=0,e.instance=this,this.objArr=[],this.brickArr=[],this.enemy=[],this.hitObject=[],this.gameLayer=new egret.Sprite,this.addChild(this.gameLayer),this.gameLayer.addChild(this.sea),this.gameLayer.addChild(this.brick),this.sea.touchEnabled=!0,this.baseLayer=new egret.Sprite,this.addChild(this.baseLayer),this.areaLayer=new egret.Sprite,this.addChild(this.areaLayer),this.objLayer=new egret.Sprite,this.gameLayer.addChild(this.objLayer),this.weaponLayer=new egret.Sprite,this.addChild(this.weaponLayer),this.toolLayer=new egret.Sprite,this.addChild(this.toolLayer),this.uiLayer=new egret.Sprite,this.addChild(this.uiLayer),this.showShape(),this.gameLayer.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchHandle,this),this.gameLayer.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseEnd,this),this.addPlayer("kuafu",320,240),this.addEnemy(400,400)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.bgMapClick=function(t){var e=Group.selectedItem;null!=e&&Group.dispose()},s.touchHandle=function(t){1!=this.player.hitRecovery&&(this.timeGo-this.mouseDownTime<200?(this.player.hitRecovery=!0,this.player.slide=9,this.player._maxSpeed=9,SoundManager.playEffect("charge_mp3")):this.mouseDown=!0,this.mouseDownTime=this.timeGo,this.player.setPath2(new Vector2D(10*(t.stageX-this.gameLayer.x-this.player.x)+this.player.x,10*(t.stageY-this.gameLayer.y-this.player.y)+this.player.y)),this.gameLayer.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this))},s.mouseMove=function(t){1!=this.player.hitRecovery&&this.player.setPath2(new Vector2D(10*(t.stageX-this.gameLayer.x-this.player.x)+this.player.x,10*(t.stageY-this.gameLayer.y-this.player.y)+this.player.y))},s.mouseEnd=function(t){this.mouseDown=!1,this.gameLayer.removeEventListener(egret.TouchEvent.TOUCH_END,this.mouseMove,this)},s.createUI=function(){this.guankaUI=new GuanKaUI(this.weaponLayer,this.objLayer),this.uiLayer.addChild(this.guankaUI),this.uiLayer.addEventListener(MainEvent.TRYAGAIN,this.tryAgainHandle,this),this.uiLayer.addEventListener(MainEvent.QUITGUANKA,this.quitHandle,this),this.guankaUI.showUI()},s.baseOrTowerTouch=function(t){Group.selectItem(t.currentTarget)},s.showShape=function(){this.shape=new egret.Shape,this.shape.graphics.beginFill(16711680,1),this.shape.graphics.drawRect(0,0,480,370),this.shape.graphics.endFill(),this.shape.alpha=0,this.addChild(this.shape)},s["float"]=function(t,e,i,s){void 0===s&&(s=60416);var a=new egret.TextField;this.addChild(a),a.anchorOffsetX=a.width/2,a.size=13,a.textColor=s,a.text=t,a.x=e,a.y=i,TweenMax.to(a,2,{y:a.y-50,alpha:0,onComplete:function(){null!=a.parent&&a.parent.removeChild(a)}})},s.effect=function(t,e,i){var s=RES.getRes(t+"_json"),a=RES.getRes(t+"_png"),n=new egret.MovieClipDataFactory(s,a),h=new egret.MovieClip;h.movieClipData=n.generateMovieClipData(t),this.objLayer.addChild(h),h.alpha=.5,h.anchorOffsetX=h.width/2,h.x=e,h.y=i,h.gotoAndPlay(t),TweenMax.delayedCall(.5,function(){null!=h.parent&&h.parent.removeChild(h)})},s.onEnterFrame=function(t){this.timeGo+=t,this.otime<Math.floor(this.timeGo/1e3)&&(this.otime=Math.floor(this.timeGo/1e3),this.stime+=1,this.atime>1?this.atime--:1==this.atime&&this.atime--,this.stime>=60&&(this.mtime++,this.stime=0)),this.removeEnemies(),this.guankaUI&&this.guankaUI.onEnterFrame(t),this.objArr=Utils.sortarr(this.objArr);for(var e=0;e<this.objArr.length;e++){var i=this.objArr[e];this.objLayer.contains(i)&&this.objLayer.setChildIndex(i,e)}},s.removeEnemies=function(){var t;for(t=0;t<this.enemy.length;t++){var e=this.enemy[t];e.canClear&&this.enemy.splice(t,1)}if(0==this.enemy.length&&this.victory(),null==this.player&&TweenMax.delayedCall(1,function(){i.lose()}),this.player.canClear){var i=this;TweenMax.delayedCall(1,function(){i.lose()})}for(t=0;t<this.objArr.length;t++){var e=this.objArr[t];e.canClear&&this.objArr.splice(t,1)}},s.addPlayer=function(t,e,i){var s;this.player=ObjectPool.getInstance().createObject(Player),this.player.addTexture(t),this.player.nameInfo="player",this.objLayer.addChild(this.player),this.objArr.push(this.player),s=[[e-4,i+10]],this.player.init(s),this.hitObject.push(this.player)},s.addEnemy=function(t,e){var i,s="kuafu",a=ObjectPool.getInstance().createObject(Enemy);a.addTexture(s),this.objLayer.addChild(a),this.objArr.push(a),i=[[t-4,e+10]],a.init(i),this.enemy.push(a),this.hitObject.push(a)},s.quitHandle=function(t){Main.instance.dispatchEvent(new MainEvent(MainEvent.OPENLOADBAR,"maps"))},s.tryAgainHandle=function(t){},s.victory=function(){this.clear(),this.guankaUI.showVictory(),StorageSetting.setGuankaPass(Main.curIdx),StorageSetting.setTowerUpgrade(Main.curIdx)},s.lose=function(){this.clear(),this.guankaUI.showLose()},s.pause=function(){egret.Ticker.getInstance().unregister(this.onEnterFrame,this)},s.clear=function(){SoundManager.stopBgSound(),egret.Ticker.getInstance().unregister(this.onEnterFrame,this),ObjectPool.getInstance().destroyAllObject()},s.destroy=function(){for(;this.objLayer.numChildren>0;)this.objLayer.removeChildAt(0);for(;this.sea.numChildren>0;)this.sea.removeChildAt(0);for(;this.brick.numChildren>0;)this.brick.removeChildAt(0);this.leftPoseArr=null,this.rightPoseArr=null,this.enemyData=null,this.hitObject=[],this.objArr=null,this.enemy=[],egret.Tween.removeAllTweens(),ObjectPool.getInstance()._pool={}},e}(egret.Sprite);egret.registerClass(GuankaBase,"GuankaBase");var Guanka01=function(t){function e(){t.call(this),this.mtime=0,this.sea.x=0,this.sea.y=-510,this.buildSea(5,5),this.leftPoseArr=[[120,160],[80,160],[160,160],[100,160],[140,160],[120,140],[80,140],[160,140],[100,140],[140,140]],this.rightPoseArr=[[360,160],[320,160],[400,160],[340,160],[380,160],[360,140],[320,140],[400,140],[340,140],[380,140]],this.createUI(),this.init(),this.buildBrick()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.buildSea=function(t,e){for(var i=0;t>i;i++)for(var s=0;e>s;s++){var a;a=Utils.createBitmapByName("sea_png"),this.sea.addChild(a),a.x=400*i+-400*s,a.y=200*i+200*s}},s.buildBrick=function(){for(var t=0;20>t;t++){this.brickArr[t]=[];for(var e=0;20>e;e++){var i;i=Utils.createBitmapByName("brick_png"),this.brick.addChild(i),i.anchorOffsetX=50,i.anchorOffsetY=25,i.x=50*t+-50*e+500,i.y=25*t+25*e-200,this.brickArr[t].push(i);var s=Math.random();.1>s&&(i.alpha=.8,s=Math.random(),.1>s&&this.addEnemy(i.x,i.y))}}},s.init=function(){this.atime=0,this.otime=0,SoundManager.playBgSound("map0bg"),egret.Ticker.getInstance().register(this.onEnterFrame,this)},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e)},s.tryAgainHandle=function(t){for(;this.objLayer.numChildren>0;)this.objLayer.removeChildAt(0);for(;this.sea.numChildren>0;)this.sea.removeChildAt(0);for(;this.brick.numChildren>0;)this.brick.removeChildAt(0);for(;this.toolLayer.numChildren>0;)this.toolLayer.removeChildAt(0);this.objArr=[],this.enemy=[],this.hitObject=[],this.init()},s.destroy=function(){t.prototype.destroy.call(this),RES.destroyRes(GuanKaConfig.guankaData[Main.curIdx]),this.roadArr1=null,this.roadArr2=null},e}(GuankaBase);egret.registerClass(Guanka01,"Guanka01");var GuanKaUI=function(t){function e(e,i){t.call(this),this.bos=new egret.TextField,this.timeTxt=new egret.TextField,this.time=120,this.gold=250,this.label=new egret.TextField,this.lifetxt=new egret.TextField,this.damagetxt=new egret.TextField,this.info=new egret.TextField,this.type=new egret.TextField,this.tip=new egret.TextField,this.canClick=!1;this.bf=RES.getRes("battle_fnt"),this.bottomSp=new egret.Sprite,this.bottomSp.x=30,this.bottomSp.y=egret.MainContext.instance.stage.stageHeight+100,this.addChild(this.bottomSp),this.tool=new UnitTool,this.tool.x=5,this.tool.y=3,this.bottomSp.addChild(this.tool)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.backToMapsHandle=function(t){TweenMax.killAll(),GuankaBase.instance.clear(),this.dispatchEvent(new MainEvent(MainEvent.QUITGUANKA,null,!0))},s.onEnterFrame=function(t){this.tool.onEnterFrame(t)},s.showUI=function(){TweenLite.to(this.bottomSp,.3,{y:egret.MainContext.instance.stage.stageHeight-80,ease:Circ.easeOut})},s.touchEnd=function(){},s.setLife=function(){},s.setBos=function(t,e,i){var s,a;s=t>9?t.toString():"0"+t.toString(),a=e>9?e.toString():"0"+e.toString(),this.bos.text=s+":"+a,i>0?(s=Math.floor(i/60)>0?"0"+Math.floor(i/60).toString():"00",a=10>i?"0"+i.toString():60>i?i.toString():10>i%60?"0"+(i%60).toString():(i%60).toString(),this.timeTxt.text=s+":"+a):this.rightSp.visible=!1},s.showVictory=function(){var t=new egret.Shape;t.graphics.beginFill(0,.6),t.graphics.drawRect(0,0,GameSetting.swid,GameSetting.shei),this.addChild(t),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.spTouch1,this),this.victoryBm=Utils.createBitmapByName("victory"),this.victoryBm.anchorOffsetX=this.victoryBm.width/2,this.victoryBm.anchorOffsetY=this.victoryBm.height/2,this.victoryBm.x=GameSetting.swid/2,this.victoryBm.y=180,this.victoryBm.scaleX=this.victoryBm.scaleY=.1,this.addChild(this.victoryBm),TweenMax.to(this.victoryBm,.5,{scaleX:1,scaleY:1,ease:Back.easeOut});var e=this;TweenMax.delayedCall(15,function(){e.dispatchEvent(new MainEvent(MainEvent.QUITGUANKA,null,!0))})},s.showLose=function(){this.mbBm=new egret.Shape,this.mbBm.graphics.beginFill(0,.6),this.mbBm.graphics.drawRect(0,0,GameSetting.swid,GameSetting.shei),this.addChild(this.mbBm),this.mbBm.touchEnabled=!0,this.mbBm.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.spTouch2,this),this.loseBm=Utils.createBitmapByName("lose"),this.loseBm.anchorOffsetX=this.loseBm.width/2,this.loseBm.anchorOffsetY=this.loseBm.height/2,this.loseBm.x=GameSetting.swid/2,this.loseBm.y=-180,this.addChild(this.loseBm),this.tryAgainBm=Utils.createBitmapByName("tryagain"),this.tryAgainBm.anchorOffsetX=this.tryAgainBm.width/2,this.tryAgainBm.anchorOffsetY=this.tryAgainBm.height/2,this.tryAgainBm.x=GameSetting.swid/2,this.tryAgainBm.y=550,this.addChild(this.tryAgainBm),this.quitBm=Utils.createBitmapByName("quitgame"),this.quitBm.anchorOffsetX=this.quitBm.width/2,this.quitBm.anchorOffsetY=this.quitBm.height/2,this.quitBm.x=GameSetting.swid/2,this.quitBm.y=550,this.addChild(this.quitBm),this.tryAgainBm.touchEnabled=!0,this.quitBm.touchEnabled=!0,this.tryAgainBm.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.tryAgainHandle,this),this.quitBm.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.tryAgainHandle,this),TweenMax.to(this.loseBm,.5,{y:150,ease:Cubic.easeOut}),TweenMax.to(this.tryAgainBm,.3,{delay:.3,y:240,ease:Cubic.easeOut}),TweenMax.to(this.quitBm,.3,{delay:.4,y:300,ease:Cubic.easeOut})},s.spTouch1=function(t){SoundManager.stopBgSound(),GuankaBase.instance.destroy(),this.dispatchEvent(new MainEvent(MainEvent.QUITGUANKA,null,!0)),t.stopPropagation()},s.tryAgainHandle=function(t){SoundManager.stopBgSound(),this.dispatchEvent(new MainEvent(MainEvent.QUITGUANKA,null,!0)),this.removeChild(this.mbBm),this.removeChild(this.loseBm),this.removeChild(this.tryAgainBm),this.removeChild(this.quitBm),t.stopPropagation()},s.spTouch2=function(t){t.stopPropagation()},e}(egret.Sprite);egret.registerClass(GuanKaUI,"GuanKaUI");var LoadBar=function(t){function e(){t.call(this),this.stageWidth=GameSetting.swid,this.stageHeight=GameSetting.shei,this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.leftP=new egret.DisplayObjectContainer,this.rightP=new egret.DisplayObjectContainer,this.addChild(this.leftP),this.addChild(this.rightP),this.bm=Utils.createBitmapByName("loadbg"),this.bm.anchorOffsetX=this.bm.width/2,this.bm.anchorOffsetY=this.bm.height,this.leftP.addChild(this.bm),this.bm=Utils.createBitmapByName("loadl"),this.bm.anchorOffsetX=this.bm.width/2,this.rightP.addChild(this.bm),this.leftP.x=this.stageWidth/2,this.rightP.x=this.stageWidth/2,this.leftP.y=this.stageHeight/2,this.rightP.y=this.stageHeight/2,this.loadP=new egret.DisplayObjectContainer,this.addChild(this.loadP),this.prol=new egret.Sprite,this.prol.x=this.stageWidth/2,this.prol.y=this.stageHeight/2,this.loadP.addChild(this.prol),this.bm=Utils.createBitmapByName("probarbg"),this.prol.addChild(this.bm),this.barl=Utils.createBitmapByName("probartop"),this.barl.x=9,this.barl.y=9,this.barl.width=1,this.prol.addChild(this.barl);var t=new egret.Rectangle(0,0,99,36);this.prol.mask=t,this.prol.anchorOffsetX=this.prol.width/2,this.prol.anchorOffsetY=this.prol.height/2,this.pror=new egret.Sprite,this.pror.x=this.stageWidth/2,this.pror.y=this.stageHeight/2,this.loadP.addChild(this.pror),this.bm=Utils.createBitmapByName("probarbg"),this.pror.addChild(this.bm),this.barr=Utils.createBitmapByName("probartop"),this.barr.x=9,this.barr.y=9,this.barr.width=1,this.pror.addChild(this.barr),this.pror.anchorOffsetX=this.pror.width/2,this.pror.anchorOffsetY=this.pror.height/2;var e=new egret.TextField;e.text="九州分裂中",e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.size=20,e.fontFamily="Microsoft YaHei",e.strokeColor=0,e.stroke=1,e.x=this.stageWidth/2+30,e.y=this.stageHeight/2+3,this.loadP.addChild(e);var t=new egret.Rectangle(99,0,99,36);this.pror.mask=t,this.showLoadBar()},s.setProgress=function(t,e){this.barl.width=t/e*182,this.barr.width=t/e*182},s.showLoadBar=function(){TweenMax.to(this.leftP,.3,{y:this.stageHeight/2,ease:Cubic.easeOut}),TweenMax.to(this.rightP,.3,{y:this.stageHeight/2,ease:Cubic.easeOut,onComplete:function(){Main.instance.dispatchEvent(new MainEvent(MainEvent.REMOVE))}})},s.hideLoadBar=function(){var t=this;TweenMax.to(this.loadP,.01,{delay:.6,y:1e3,ease:Cubic.easeOut}),TweenMax.to(this.leftP,1.5,{delay:.6,y:-400,ease:Cubic.easeOut}),TweenMax.to(this.rightP,1.5,{delay:.6,y:800,ease:Cubic.easeOut,onComplete:function(){null!=t.parent&&t.parent.removeChild(t)}})},e}(egret.DisplayObjectContainer);egret.registerClass(LoadBar,"LoadBar");var Loader=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getInstance=function(){if(null==e.instance){var t=new e;e.instance=t}return e.instance},s.init=function(){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/resource.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){this.loadevent=new LoadEvent(LoadEvent.GROUP_PROGRESS),this.loadevent.groupName=t.groupName,this.loadevent.itemsLoaded=t.itemsLoaded,this.loadevent.itemsTotal=t.itemsTotal,this.dispatchEvent(this.loadevent),this.loadevent=null},s.onResourceLoadComplete=function(t){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.loadevent=new LoadEvent(LoadEvent.GROUP_COMPLETE),this.loadevent.groupName=t.groupName,this.dispatchEvent(this.loadevent),this.loadevent=null},s.load=function(t){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(t)},e}(egret.EventDispatcher);egret.registerClass(Loader,"Loader");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var LoadingUI2=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI2,"LoadingUI2");var Main=function(t){function e(){t.call(this),this.views=[],this.senceName={welcomeload:"Index",maps:"World",guanka01load:"Guanka01",guanka02load:"Guanka02",guanka03load:"Guanka03",guanka04load:"Guanka04",guanka05load:"Guanka05",guanka06load:"Guanka06",guanka07load:"Guanka07",guanka08load:"Guanka08",guanka09load:"Guanka09",guanka10load:"Guanka10",guanka11load:"Guanka11",guanka12load:"Guanka12"},this.loadIndexis1st=!0,this.isRotation=!1,e.instance=this,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){console.log(document.body.clientWidth),this.loadingView=new LoadingUI,this.addChild(this.loadingView),Loader.getInstance(),Loader.instance.addEventListener(LoadEvent.GROUP_COMPLETE,this.loadComp,this),Loader.instance.addEventListener(LoadEvent.GROUP_PROGRESS,this.loadprogress,this),Loader.instance.init(),this.addEventListener(MainEvent.REMOVE,this.removeLast,this),this.addEventListener(MainEvent.OPENLOADBAR,this.createLoadBar,this),this.addEventListener(MainEvent.LOADCOMP,this.addSence,this)},s.loadprogress=function(t){var e=t.groupName;switch(e){case"preload":this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal);break;case"welcomeload":if(this.loadIndexis1st){this.preload.setProgress(t.itemsLoaded,t.itemsTotal);break}default:this.loadBar.setProgress(t.itemsLoaded,t.itemsTotal)}},s.loadComp=function(t){var i=t.groupName;switch(i){case"preload":this.removeChild(this.loadingView),this.loadingView=null,this.createScene(),StorageSetting.loadConfig();break;case"welcomeload":if(this.loadIndexis1st){this.preload.loadComp(),this.loadIndexis1st=!1;break}default:"uiLoad"==t.groupName?(console.log("加载怪物资源"),Loader.instance.load("monsterLoad")):"monsterLoad"==t.groupName?(console.log("加载塔类资源"),Loader.instance.load("towerLoad")):"towerLoad"==t.groupName?(console.log("加载音效资源"),Loader.instance.load("soundLoad")):"soundLoad"==t.groupName?(console.log("加载关卡资源"),Loader.instance.load(GuanKaConfig.guankaData[e.curIdx])):(this.dispatchEvent(new MainEvent(MainEvent.LOADCOMP,t.groupName)),this.loadBar.hideLoadBar())}},s.createLoadBar=function(t){this.resName=t.resName,this.loadBar=new LoadBar,this.addChild(this.loadBar)},s.removeLast=function(t){Loader.instance.load(this.resName),this.gameLayer.removeChildAt(0);var e=this.views.shift();null!=e&&e.destroy()},s.addSence=function(t){var e=egret.getDefinitionByName(this.senceName[t.resName]),i=new e;this.gameLayer.addChild(i),this.views.push(i)},s.createScene=function(){egret.MainContext.deviceType==egret.MainContext.DEVICE_MOBILE&&(this.isRotation=!0),this.gameLayer=new egret.DisplayObjectContainer,this.addChild(this.gameLayer),this.preload=new PreLoad,this.gameLayer.addChild(this.preload)},s.init=function(){this.gameLayer.removeChildAt(0),this.preload=null},s.onRotation=function(t){},e.wujin=!1,e.loadCommis1st=!0,e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var PreLoad=function(t){function e(){t.call(this),this.stageWidth=GameSetting.swid,this.stageHeight=GameSetting.shei,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("0ui_bg"),this.bg.anchorOffsetX=this.bg.width/2,this.bg.anchorOffsetY=this.bg.height/2,this.bg.x=this.stageWidth/2,this.bg.y=this.stageHeight/2,this.addChild(this.bg),this.barbg=new egret.Bitmap,this.barbg.texture=RES.getRes("probarbg"),this.barbg.anchorOffsetX=this.barbg.width/2,this.barbg.x=this.stageWidth/2,this.barbg.y=this.stageHeight-138,this.addChild(this.barbg),this.sp=new egret.DisplayObjectContainer,this.sp.x=this.stageWidth/2-91,this.sp.y=this.stageHeight-129,this.addChild(this.sp),this.bartop=new egret.Bitmap,this.bartop.texture=RES.getRes("probartop"),this.bartop.width=1,this.sp.addChild(this.bartop),Loader.instance.load("welcomeload")
},s.setProgress=function(t,e){this.bartop.width=t/e*182},s.loadComp=function(){this.removeChild(this.barbg),this.removeChild(this.sp),this.barbg=null,this.bartop=null,this.sp=null,this.btn=new egret.Bitmap,this.btn.texture=RES.getRes("0ui_btn"),this.btn.anchorOffsetX=this.btn.width/2,this.btn.x=this.stageWidth/2,this.btn.y=this.stageHeight-100,this.addChild(this.btn),this.btn.touchEnabled=!0,this.btn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchH,this)},s.destroy=function(){RES.destroyRes("0ui_bg"),RES.destroyRes("0ui_btn")},s.touchH=function(t){this.btn.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchH,this),Main.curIdx=0,Main.instance.dispatchEvent(new MainEvent(MainEvent.OPENLOADBAR,"uiLoad")),this.destroy()},e}(egret.DisplayObjectContainer);egret.registerClass(PreLoad,"PreLoad");var ArrowShooterBase=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onEnterFrame=function(t){this.currentLabel==this.endLabel&&this.gotoAndStop(this.idleLabel)},s.fire=function(t){"downR"==t?(this.startLabel="shootDown",this.endLabel="shootDownEnd",this.idleLabel="idleDown",this.scaleX=1):"upR"==t?(this.startLabel="shootUp",this.endLabel="shootUpEnd",this.idleLabel="idleUp",this.scaleX=1):"downL"==t?(this.startLabel="shootDown",this.endLabel="shootDownEnd",this.idleLabel="idleDown",this.scaleX=-1):"upL"==t&&(this.startLabel="shootUp",this.endLabel="shootUpEnd",this.idleLabel="idleUp",this.scaleX=-1),this.gotoAndPlay(this.startLabel)},e}(egret.MovieClip);egret.registerClass(ArrowShooterBase,"ArrowShooterBase");var ArrowShooter01=function(t){function e(){t.call(this);var e=RES.getRes("ArrowShooter01json"),i=RES.getRes("ArrowShooter01png"),s=new egret.MovieClipDataFactory(e,i);this.movieClipData=s.generateMovieClipData("ArrowShooter01"),this.anchorOffsetX=this.width/2,this.startLabel="",this.endLabel="",this.idleLabel="idleDown"}__extends(e,t);var i=(__define,e);i.prototype;return e}(ArrowShooterBase);egret.registerClass(ArrowShooter01,"ArrowShooter01");var ArrowShooter02=function(t){function e(){t.call(this);var e=RES.getRes("ArrowShooter02json"),i=RES.getRes("ArrowShooter02png"),s=new egret.MovieClipDataFactory(e,i);this.movieClipData=s.generateMovieClipData("ArrowShooter02"),this.anchorOffsetX=this.width/2,this.startLabel="",this.endLabel="",this.idleLabel="idleDown"}__extends(e,t);var i=(__define,e);i.prototype;return e}(ArrowShooterBase);egret.registerClass(ArrowShooter02,"ArrowShooter02");var ArrowShooter031=function(t){function e(){t.call(this);var e=RES.getRes("ArrowShooter031json"),i=RES.getRes("ArrowShooter031png"),s=new egret.MovieClipDataFactory(e,i);this.movieClipData=s.generateMovieClipData("ArrowShooter03_1"),this.anchorOffsetX=this.width/2,this.startLabel="",this.endLabel="",this.idleLabel="idleDown"}__extends(e,t);var i=(__define,e);i.prototype;return e}(ArrowShooterBase);egret.registerClass(ArrowShooter031,"ArrowShooter031");var ArrowShooter032=function(t){function e(){t.call(this);var e=RES.getRes("ArrowShooter032json"),i=RES.getRes("ArrowShooter032png"),s=new egret.MovieClipDataFactory(e,i);this.movieClipData=s.generateMovieClipData("ArrowShooter03_2"),this.anchorOffsetX=this.width/2,this.startLabel="",this.endLabel="",this.idleLabel="idleDown"}__extends(e,t);var i=(__define,e);i.prototype;return e}(ArrowShooterBase);egret.registerClass(ArrowShooter032,"ArrowShooter032");var VectorElements=function(t){function e(){t.call(this),this.posArr=[],this._maxSpeed=3,this.slide=3,this.target=null,this._angle=0,this.moveToTarget=!1,this._arrivalThreshold=2,this._pathThreshold=5,this.maxSoldRadius=250,this.minSoldRadius=250,this.hitRecovery=!1,this._position=new Vector2D,this._velocity=new Vector2D,this._steeringForce=new Vector2D}__extends(e,t);var i=__define,s=e,a=s.prototype;return a.onEnterFrame=function(t){if(this.curState==stateType.moveState){this.followPath(this.posArr),this._velocity=this._velocity.add(this._steeringForce),this._steeringForce=new Vector2D,this.hitRecovery?this._velocity.truncate(this.slide):this._velocity.truncate(this._maxSpeed),this._position=this._position.add(this._velocity);var e=GuankaBase.instance.hitObject;null!=this.target&&(Math.abs(this.x-this.target.x)>30||Math.abs(this.y-this.target.y)>30)&&(this.target=null);for(var i=0;i<e.length;i++)if(Math.abs(this.x-e[i].x)<30&&Math.abs(this.y-e[i].y)<30&&e[i]!=this&&e[i]!=this.target){this.target=e[i],this.hitRecovery=!0,e[i].hitRecovery=!0;var s,a=new Vector2D(this.position.x-this.x,this.position.y-this.y),n=new Vector2D(e[i].x-this.x,e[i].y-this.y);Vector2D.angleBetween(a,n);e[i].slide=5,"player"!=this.nameInfo&&(this._maxSpeed+=1.5),s=2*this._maxSpeed-3,console.log(s),e[i].setPath2(new Vector2D((e[i].x-this.x)*s+this.x,(e[i].y-this.y)*s+this.y))}"player"==this.nameInfo?(GuankaBase.instance.gameLayer.x-=this.position.x-this.x,GuankaBase.instance.gameLayer.y-=this.position.y-this.y):this.moveToTarget=!1,this.x=this.position.x,this.y=this.position.y;var h=GuankaBase.instance.brickArr;this.curState==stateType.moveState&&0==this.hitRecovery&&(this._angle=(180*this._velocity.angle/Math.PI+360)%360);for(var r=0;r<h.length;r++)for(var o=0;o<h[r].length;o++)if(Math.abs(this.x-h[r][o].x)<60&&Math.abs(this.y-h[r][o].y)<35)return;this.fsm.changeState(stateType.deadEndState),GuankaBase.instance.effect("water",this.x,this.y),SoundManager.playEffect("water_mp3")}},a.setPath2=function(t){this.posArr.length=0,this.posArr.push(t),this.fsm.changeState(stateType.moveState)},a.followPath=function(t,e){void 0===e&&(e=!1);var i=t[this._pathIndex];null!=i&&(this._position.dist(i)<this._pathThreshold&&(this._pathIndex>=t.length-1?e&&(this._pathIndex=0):this._pathIndex++),this._pathIndex>=t.length-1&&!e?this.arrive(i):this.seek(i))},i(a,"position",function(){return this._position},function(t){this._position=t,this.x=this._position.x,this.y=this._position.y}),i(a,"velocity",function(){return this._velocity},function(t){this._velocity=t}),a.seek=function(t){var e=t.subtract(this._position);e.normalize(),e=this.hitRecovery?e.multiply(this.slide):e.multiply(this._maxSpeed);var i=e.subtract(this._velocity);this._steeringForce=this._steeringForce.add(i)},a.arrive=function(t){var e=t.subtract(this._position);e.normalize();var i=this._position.dist(t);i>this._arrivalThreshold?e=this.hitRecovery?e.multiply(this.slide):e.multiply(this._maxSpeed):(e=e.zero(),this._velocity=this._velocity.zero(),this.fsm.changeState(stateType.moveEndState));var s=e.subtract(this._velocity);this._steeringForce=this._steeringForce.add(s)},a.selectItem=function(){this.dispatchEvent(new TowerEvent(TowerEvent.SHOWTOOL,this))},a.deselectItem=function(){this.dispatchEvent(new TowerEvent(TowerEvent.HIDETOOL,this))},a.reselectItem=function(){this.dispatchEvent(new TowerEvent(TowerEvent.HIDETOOL,this)),Group.dispose()},e}(Elements);egret.registerClass(VectorElements,"VectorElements",["IGroupItem"]);var AttackArcherBase=function(t){function e(){t.call(this),this.moveToTarget=!1,this.fireDelay=0,this.timesum=0,this.xoffset=0,this.yoffset=0,this.atjijie=!1,this.fsm=new StateMachine(this),this.lifeBar=new LifeBar,this.addChild(this.lifeBar)}__extends(e,t);var i=__define,s=e,a=s.prototype;return a.setPath2=function(t){this.posArr.length=0,this.posArr.push(t),this.fsm.changeState(stateType.moveState)},a.live=function(){this._hp<=0&&this.fsm.changeState(stateType.deadState),this._hp>this.life&&(this._hp=this.life)},i(a,"hp",function(){return this._hp},function(t){this._hp=t,this.live(),this.lifeBar.setProgress(this._hp,this.life)}),a.createYQ=function(){this.view.touchEnabled=!1},a.clearYQ=function(){null!=this.selectYQ&&(this.removeChild(this.selectYQ),this.selectYQ=null),this.view.touchEnabled=!0},a.onDestroy=function(){t.prototype.onDestroy.call(this),null!=this.target&&(this.target=null),this.clearYQ()},a.hittest=function(){if(null!=this.target&&this.target.hp<=0){var t=this.targets.indexOf(this.target);-1!=t&&this.targets.splice(t,1),t=this.atargets.indexOf(this.target),-1!=t&&this.atargets.splice(t,1),this.target=null}},a.onEnterFrame=function(e){this.timesum+=e,this.fsm.onEnterFrame(e),t.prototype.onEnterFrame.call(this,e),this.canClear&&ObjectPool.getInstance().destroyObject(this)},a.getMoveAngle=function(t){t>=0&&60>=t||t>=300&&360>=t?(this.stateLabel="walking",this.view.scaleX=1):t>60&&120>t?this.stateLabel="walkingDown":t>=120&&240>=t?(this.stateLabel="walking",this.view.scaleX=-1):t>240&&300>t&&(this.stateLabel="walkingUp")},a.idling=function(){this.curState!=stateType.idleState&&(this.curState=stateType.idleState,this.view.gotoAndPlay(this.stateLabel)),this.moveOrFight(),this.checkLast(this.stateLabel)},a.moving=function(){this.getMoveAngle(this._angle),this.curState!=stateType.moveState&&(this.curState=stateType.moveState,this.view.gotoAndPlay(this.stateLabel)),this.moveOrFight(),this.checkLast(this.stateLabel)},a.movingEnd=function(){this.curState!=stateType.moveEndState&&(this.curState=stateType.moveEndState,this.canClear=!0)},a.fighting=function(){this.curState!=stateType.fightState&&(this.curState=stateType.fightState,null!=this.target&&(this.y>=this.target.y?this.stateLabel="shootUp":this.stateLabel="shootDown"),this.view.gotoAndPlay(this.stateLabel)),this.checkLastEnd(this.stateLabel)},a.fightingEnd=function(){this.curState!=stateType.fightEndState&&(this.curState=stateType.fightEndState,this.hittest(),this.timesum=0),null==this.target?(this.fsm.changeState(stateType.moveState),this.moveOrFight()):this.timesum>=this.fireDelay&&(this.fsm.changeState(stateType.fightState),this.timesum=0)},a.dying=function(){this.curState!=stateType.deadState&&(this.curState=stateType.deadState,this.view.gotoAndPlay(this.stateLabel)),this.checkLastEnd(this.stateLabel)},a.dyingEnd=function(){this.curState!=stateType.deadEndState&&(this.curState=stateType.deadEndState,this.canClear=!0)},a.checkLast=function(t){this.view.isPlaying||this.view.gotoAndPlay(t)},a.checkLastEnd=function(t){this.view.isPlaying||(this.view.stop(),this.curState==stateType.fightState?this.fsm.changeState(stateType.fightEndState):this.curState==stateType.deadState&&this.fsm.changeState(stateType.deadEndState))},a.isIdle=function(){return this.stateLabel="walkingUp",!0},a.isMove=function(){return!0},a.isFighting=function(){return!0},a.isDead=function(){return this.stateLabel="dead",!0},a.moveOrFight=function(){this.getTarget(),null!=this.target&&Math.abs(this.target.x-this.x)<=this.maxSoldRadius&&Math.abs(this.target.y-this.y)<=this.minSoldRadius&&this.fsm.changeState(stateType.fightState)},a.getTarget=function(){var t;for(this.atargets=[],t=0;t<this.targets.length;t++){var e=this.targets[t],i=Utils.containsXY(e.x,e.y,this.x,this.y,this.maxSoldRadius,this.ratioSoldY),s=this.atargets.indexOf(e);i?-1==s&&this.atargets.push(e):-1!=s&&this.atargets.splice(s,1)}var a=this.atargets.length;if(a>0&&null==this.target){var n=this.atargets[0];this.target=n}},e}(VectorElements);egret.registerClass(AttackArcherBase,"AttackArcherBase",["ILife","IGroupItem"]);var AttackArcher01=function(t){function e(){t.call(this),this.view=new egret.MovieClip,this.addChild(this.view)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addTexture=function(t,e){this.nameInfo=e;var i=RES.getRes(t+"_json"),s=RES.getRes(t+"_png"),a=new egret.MovieClipDataFactory(i,s);this.view.movieClipData=a.generateMovieClipData(t),this.view.x=this.view.width/2,this.anchorOffsetX=this.width/2,this.lifeBar.x=(this.view.width-this.lifeBar.width)/2,this.lifeBar.y=-50,this._maxSpeed=.3,this.offy=10},s.onCreate=function(){this.posArr=[],this._pathIndex=0,this.timesum=0,this.lifeBar.reSet(),this.canClear=!1,this.atjijie=!1,this.moveToTarget=!1,this.fsm.changeState(stateType.moveState),this.curState=stateType.moveState},s.init=function(t,e,i){this.hp=this.life=e,this.damage=i,this.atjijie=!0,this._position.x=this.x=t[0][0],this._position.y=this.y=t[0][1],this.fsm.changeState(stateType.idleState)},s.initRoad=function(t){var e=1;t.length;for(e;e<t.length;e++)this.jijieDian=new Vector2D(t[e][0]+this.xoffset,t[e][1]+this.yoffset),this.posArr.push(this.jijieDian);this.fsm.changeState(stateType.moveState),this.ratioSoldY=this.minSoldRadius/this.maxSoldRadius},s.playFireVoice=function(){Math.random()>.5?SoundManager.playEffect("arrow_fire1"):SoundManager.playEffect("arrow_fire2")},s.setPoint=function(t){this.dispatchEvent(new SoldEvent(SoldEvent.MOVE,this,t))},s.setPath=function(t){this.atjijie=!0,this.posArr.length=0,this.jijieDian=new Vector2D(t[0]+this.xoffset,t[1]+this.yoffset),this.posArr.push(this.jijieDian),this.fsm.changeState(stateType.moveState),null!=this.target&&(null!=this.target.target&&(this.target.target=null),this.target=null)},s.onEnterFrame=function(e){if(t.prototype.onEnterFrame.call(this,e),0==this.atargets.length)return void(this.timesum=this.fireDelay);if(this.timesum+=e,!(this.timesum<this.fireDelay||(this.timesum=0,this.playFireVoice(),this.weapon=ObjectPool.getInstance().createObject(Arrow01),this.hp<=0||null==this.target))){this.weapon.damage=this.damage;var i;if(i=new egret.Point(this.x,this.y-50),this.weapon.init(i,this.target,this.target.offy),this.weapon.unit=this,GuankaBase.instance.weaponLayer.addChild(this.weapon),this.weapon.damage>=this.target.hp){var s=this.targets.indexOf(this.target);-1!=s&&this.targets.splice(s,1),s=this.atargets.indexOf(this.target),-1!=s&&this.atargets.splice(s,1),this.target=null}}},s.viewSelect=function(t){Group.selectItem(this)},s.onDestroy=function(){t.prototype.onDestroy.call(this),this.view.touchEnabled=!1,this.view.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.viewSelect,this)},e}(AttackArcherBase);egret.registerClass(AttackArcher01,"AttackArcher01");var EnemyBase=function(t){function e(){t.call(this),this.fireDelay=0,this.timesum=0,this.xoffset=0,this.yoffset=0,this.atjijie=!1,this.voiceArr=["shield_fire1","shield_fire2","shield_fire3"],this.fsm=new StateMachine(this),this.maxSoldRadius=150}__extends(e,t);var i=(__define,e),s=i.prototype;return s.live=function(){this._hp<=0&&this.fsm.changeState(stateType.deadState),this._hp>this.life&&(this._hp=this.life)},s.onDestroy=function(){t.prototype.onDestroy.call(this),null!=this.target&&(this.target=null)},s.hittest=function(){if(null!=this.target&&this.target.hp<=0){var t=this.targets.indexOf(this.target);-1!=t&&this.targets.splice(t,1),t=this.atargets.indexOf(this.target),-1!=t&&this.atargets.splice(t,1),this.target=null}},s.onEnterFrame=function(e){this.timesum+=e,this.fsm.onEnterFrame(e),t.prototype.onEnterFrame.call(this,e),this.canClear&&ObjectPool.getInstance().destroyObject(this),this._maxSpeed>1.5&&(this._maxSpeed-=.05)},s.getMoveAngle=function(t){t>=0&&60>=t||t>=300&&360>=t?(this.stateLabel="walking",this.view.scaleX=1):t>60&&120>t?this.stateLabel="walkingDown":t>=120&&240>=t?(this.stateLabel="walking",this.view.scaleX=-1):t>240&&300>t&&(this.stateLabel="walkingUp")},s.idling=function(){this.curState!=stateType.idleState&&(this.curState=stateType.idleState,this.view.gotoAndPlay(this.stateLabel)),this.checkLast(this.stateLabel),0==this.hitRecovery&&this.moveOrFight()},s.moving=function(){this.getMoveAngle(this._angle),this.curState!=stateType.moveState&&(this.curState=stateType.moveState,this.view.gotoAndPlay(this.stateLabel)),this.checkLast(this.stateLabel),0==this.hitRecovery&&this.moveOrFight()},s.movingEnd=function(){this.curState!=stateType.moveEndState&&(this.curState=stateType.moveEndState,this.fsm.changeState(stateType.idleState)),console.log("123"),this.hitRecovery=!1,this._maxSpeed=1.5,this.moveToTarget=!1},s.fighting=function(){if(this.curState!=stateType.fightState){this.curState=stateType.fightState,this.view.gotoAndPlay(this.stateLabel),null!=this.target&&(this.x<=this.target.x?this.view.scaleX=1:this.view.scaleX=-1);var t=Math.floor(3*Math.random());SoundManager.playEffect(this.voiceArr[t])}this.checkLastEnd(this.stateLabel)},s.fightingEnd=function(){this.curState!=stateType.fightEndState&&(this.curState=stateType.fightEndState,this.hittest(),this.timesum=0),null==this.target?this.fsm.changeState(stateType.moveState):this.timesum>=this.fireDelay&&(this.fsm.changeState(stateType.fightState),this.timesum=0)},s.dying=function(){this.curState!=stateType.deadState&&(this.curState=stateType.deadState,this.view.gotoAndPlay(this.stateLabel)),this.checkLastEnd(this.stateLabel)},s.dyingEnd=function(){this.curState!=stateType.deadEndState&&(this.curState=stateType.deadEndState,this.canClear=!0)},s.checkLast=function(t){this.view.isPlaying||this.view.gotoAndPlay(t)},s.checkLastEnd=function(t){this.view.isPlaying||(this.view.stop(),this.curState==stateType.fightState?this.fsm.changeState(stateType.fightEndState):this.curState==stateType.deadState&&this.fsm.changeState(stateType.deadEndState))},s.isIdle=function(){return this.stateLabel="walkingDown",!0},s.isMove=function(){return!0},s.isFighting=function(){return this.stateLabel="fighting",!0},s.isDead=function(){return this.stateLabel="dead",!0},s.moveOrFight=function(){if(!this.moveToTarget&&!this.canClear&&null!=GuankaBase.instance.player&&Math.abs(this.x-GuankaBase.instance.player.x)<=this.maxSoldRadius&&Math.abs(this.y-GuankaBase.instance.player.y)<=this.minSoldRadius){if(this.fireDelay>1e3&&this.timesum>=this.fireDelay){this.moveToTarget=!0,SoundManager.playEffect("kuafuCharge_mp3"),GuankaBase.instance.effect("charge",this.x+40,this.y),this._maxSpeed=.01,this.timesum=0;var t=this;return void TweenMax.delayedCall(1.2,function(){t._maxSpeed=12,t.timesum=0,t.setPath2(new Vector2D(1.2*(GuankaBase.instance.player.x-t.x)+t.x,1.2*(GuankaBase.instance.player.y-t.y)+t.y))})}this.setPath2(new Vector2D(1.2*(GuankaBase.instance.player.x-this.x)+this.x,1.2*(GuankaBase.instance.player.y-this.y)+this.y))}},e}(VectorElements);egret.registerClass(EnemyBase,"EnemyBase",["ILife","IGroupItem"]);var Enemy=function(t){function e(){t.call(this),this.hp=260,this.damage=60,this.view=new egret.MovieClip,this.addChild(this.view)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addTexture=function(t){this.nameInfo=name;var e=RES.getRes(t+"_json"),i=RES.getRes(t+"_png"),s=new egret.MovieClipDataFactory(e,i);this.view.movieClipData=s.generateMovieClipData(t),this.view.x=this.view.width/2,this._maxSpeed=1.5,this.anchorOffsetX=this.width/2,this.life=this.hp=40,this.offy=10,this.fireDelay=15e3},s.onCreate=function(){this.posArr=[],this._pathIndex=0,this.timesum=4e3,this.canClear=!1,this.atjijie=!1,this.moveToTarget=!1,this.fsm.changeState(stateType.moveState),this.curState=stateType.moveState},s.init=function(t){this.atjijie=!0,this._position.x=this.x=t[0][0],this._position.y=this.y=t[0][1],this.fsm.changeState(stateType.idleState)},s.initRoad=function(t){var e=1;t.length;for(e;e<t.length;e++)this.jijieDian=new Vector2D(t[e][0]+this.xoffset,t[e][1]+this.yoffset),this.posArr.push(this.jijieDian);this.fsm.changeState(stateType.moveState),this.ratioSoldY=this.minSoldRadius/this.maxSoldRadius},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e)},s.onDestroy=function(){t.prototype.onDestroy.call(this)},e}(EnemyBase);egret.registerClass(Enemy,"Enemy");var MagicMage01=function(t){function e(){t.call(this),this.time=0,this.cd=5e3,this["float"]=new egret.TextField,this.view=new egret.MovieClip,this.addChild(this.view)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addTexture=function(t,e){this.nameInfo=e,this.anchorOffsetX=this.width/2;var i=RES.getRes(t+"_json"),s=RES.getRes(t+"_png"),a=new egret.MovieClipDataFactory(i,s);this.view.movieClipData=a.generateMovieClipData(t),this.view.x=this.view.width/2,this.lifeBar.x=(this.view.width-this.lifeBar.width)/2,this.lifeBar.y=-50,this._maxSpeed=.7,this.offy=10,this.fireDelay=1500},s.onCreate=function(){this.posArr=[],this._pathIndex=0,this.timesum=0,this.lifeBar.reSet(),this.canClear=!1,this.atjijie=!1,this.moveToTarget=!1,this.fsm.changeState(stateType.moveState),this.curState=stateType.moveState},s.init=function(t,e,i){this.hp=this.life=e,this.damage=i,this.atjijie=!0,this._position.x=this.x=t[0][0],this._position.y=this.y=t[0][1],this.fsm.changeState(stateType.idleState),"s14"==this.nameInfo&&GuankaBase.instance.addPlayer("s14_1",this.x-10,this.y+5)},s.initRoad=function(t){var e=1;t.length;for(e;e<t.length;e++)this.jijieDian=new Vector2D(t[e][0]+this.xoffset,t[e][1]+this.yoffset),this.posArr.push(this.jijieDian);this.fsm.changeState(stateType.moveState)},s.playFireVoice=function(){Math.random()>.5?SoundManager.playEffect("arrow_fire1"):SoundManager.playEffect("arrow_fire2")},s.setPoint=function(t){this.dispatchEvent(new SoldEvent(SoldEvent.MOVE,this,t))},s.setPath=function(t){this.atjijie=!0,this.posArr.length=0,this.jijieDian=new Vector2D(t[0]+this.xoffset,t[1]+this.yoffset),this.posArr.push(this.jijieDian),this.fsm.changeState(stateType.moveState),null!=this.target&&(null!=this.target.target&&(this.target.target=null),this.target=null)},s.onEnterFrame=function(e){if(t.prototype.onEnterFrame.call(this,e),0==this.atargets.length)return void(this.timesum=this.fireDelay);if(this.timesum+=e,!(this.timesum<this.fireDelay||(this.timesum=0,this.playFireVoice(),this.weapon=ObjectPool.getInstance().createObject(MagicBullet010203),this.hp<=0||null==this.target))){this.weapon.damage=this.damage;var i;if(i=new egret.Point(this.x,this.y-50),this.weapon.init(this,i,this.target),GuankaBase.instance.weaponLayer.addChild(this.weapon),this.weapon.damage>=this.target.hp){var s=this.targets.indexOf(this.target);-1!=s&&this.targets.splice(s,1),s=this.atargets.indexOf(this.target),-1!=s&&this.atargets.splice(s,1),this.target=null}}},s.viewSelect=function(t){Group.selectItem(this)},s.onDestroy=function(){t.prototype.onDestroy.call(this),this.view.touchEnabled=!1,this.view.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.viewSelect,this)},e}(AttackArcherBase);egret.registerClass(MagicMage01,"MagicMage01");var PlayerBase=function(t){function e(){t.call(this),this.fireDelay=0,this.timesum=0,this.xoffset=0,this.yoffset=0,this.atjijie=!1,this.voiceArr=["shield_fire1","shield_fire2","shield_fire3"],this.fsm=new StateMachine(this),this.maxSoldRadius=150}__extends(e,t);var i=(__define,e),s=i.prototype;return s.live=function(){this._hp<=0&&this.fsm.changeState(stateType.deadState),this._hp>this.life&&(this._hp=this.life)},s.onDestroy=function(){t.prototype.onDestroy.call(this),null!=this.target&&(this.target=null)},s.hittest=function(){if(null!=this.target&&this.target.hp<=0){var t=this.targets.indexOf(this.target);-1!=t&&this.targets.splice(t,1),t=this.atargets.indexOf(this.target),-1!=t&&this.atargets.splice(t,1),this.target=null}},s.onEnterFrame=function(e){this.timesum+=e,this.fsm.onEnterFrame(e),t.prototype.onEnterFrame.call(this,e),this.canClear&&ObjectPool.getInstance().destroyObject(this),this._maxSpeed>3&&(this._maxSpeed-=.1),this.slide>3?this.slide-=.1:(this.hitRecovery=!1,this._maxSpeed=3,this.target=null)},s.getMoveAngle=function(t){t>=0&&60>=t||t>=300&&360>=t?(this.stateLabel="walking",this.view.scaleX=1):t>60&&120>t?this.stateLabel="walkingDown":t>=120&&240>=t?(this.stateLabel="walking",this.view.scaleX=-1):t>240&&300>t&&(this.stateLabel="walkingUp")},s.idling=function(){this.curState!=stateType.idleState&&(this.curState=stateType.idleState,this.view.gotoAndPlay(this.stateLabel)),this.checkLast(this.stateLabel)},s.moving=function(){this.getMoveAngle(this._angle),this.curState!=stateType.moveState&&(this.curState=stateType.moveState,this.view.gotoAndPlay(this.stateLabel)),this.checkLast(this.stateLabel)},s.movingEnd=function(){this.curState!=stateType.moveEndState&&(this.curState=stateType.moveEndState,this.fsm.changeState(stateType.idleState)),this.hitRecovery=!1,this._maxSpeed=3},s.fighting=function(){if(this.curState!=stateType.fightState){this.curState=stateType.fightState,this.view.gotoAndPlay(this.stateLabel),null!=this.target&&(this.x<=this.target.x?this.view.scaleX=1:this.view.scaleX=-1);var t=Math.floor(3*Math.random());SoundManager.playEffect(this.voiceArr[t])}this.checkLastEnd(this.stateLabel)},s.fightingEnd=function(){this.curState!=stateType.fightEndState&&(this.curState=stateType.fightEndState,this.hittest(),this.timesum=0),null==this.target?this.fsm.changeState(stateType.moveState):this.timesum>=this.fireDelay&&(this.fsm.changeState(stateType.fightState),this.timesum=0)},s.dying=function(){this.curState!=stateType.deadState&&(this.curState=stateType.deadState,this.view.gotoAndPlay(this.stateLabel)),this.checkLastEnd(this.stateLabel)},s.dyingEnd=function(){this.curState!=stateType.deadEndState&&(this.curState=stateType.deadEndState,this.canClear=!0)},s.checkLast=function(t){this.view.isPlaying||this.view.gotoAndPlay(t)},s.checkLastEnd=function(t){this.view.isPlaying||(this.view.stop(),this.curState==stateType.fightState?this.fsm.changeState(stateType.fightEndState):this.curState==stateType.deadState&&this.fsm.changeState(stateType.deadEndState))},s.isIdle=function(){return this.stateLabel="walkingDown",!0},s.isMove=function(){return!0},s.isFighting=function(){return this.stateLabel="fighting",!0},s.isDead=function(){return this.stateLabel="dead",!0},e}(VectorElements);egret.registerClass(PlayerBase,"PlayerBase",["ILife","IGroupItem"]);var Player=function(t){function e(){t.call(this),this.hp=260,this.damage=60,this.view=new egret.MovieClip,this.addChild(this.view)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addTexture=function(t){var e=RES.getRes(t+"_json"),i=RES.getRes(t+"_png"),s=new egret.MovieClipDataFactory(e,i);this.view.movieClipData=s.generateMovieClipData(t),this.view.x=this.view.width/2,this._maxSpeed=3,this.anchorOffsetX=this.width/2,this.life=this.hp=40,this.offy=10,this.fireDelay=1e3},s.onCreate=function(){this.posArr=[],this._pathIndex=0,this.timesum=0,this.canClear=!1,this.atjijie=!1,this.moveToTarget=!1,this.fsm.changeState(stateType.moveState),this.curState=stateType.moveState},s.init=function(t){this.atjijie=!0,this._position.x=this.x=t[0][0],this._position.y=this.y=t[0][1],this.fsm.changeState(stateType.idleState)},s.initRoad=function(t){var e=1;t.length;for(e;e<t.length;e++)this.jijieDian=new Vector2D(t[e][0]+this.xoffset,t[e][1]+this.yoffset),this.posArr.push(this.jijieDian);this.fsm.changeState(stateType.moveState),this.ratioSoldY=this.minSoldRadius/this.maxSoldRadius},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e)},s.onDestroy=function(){t.prototype.onDestroy.call(this)},e}(PlayerBase);egret.registerClass(Player,"Player");var ShieldSoldier01=function(t){function e(){t.call(this),this.hp=260,this.damage=60,this.view=new egret.MovieClip,this.addChild(this.view)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addTexture=function(t,e){this.nameInfo=e;var i=RES.getRes(t+"_json"),s=RES.getRes(t+"_png"),a=new egret.MovieClipDataFactory(i,s);this.view.movieClipData=a.generateMovieClipData(t),this.view.x=this.view.width/2,this._maxSpeed=.7,this.anchorOffsetX=this.width/2,this.offy=10,this.fireDelay=1e3},s.onCreate=function(){this.posArr=[],this._pathIndex=0,this.timesum=0,this.canClear=!1,this.atjijie=!1,this.moveToTarget=!1,this.fsm.changeState(stateType.moveState),this.curState=stateType.moveState},s.init=function(t,e,i){this.hp=this.life=e,this.damage=i,this.atjijie=!0,this._position.x=this.x=t[0][0],this._position.y=this.y=t[0][1],this.fsm.changeState(stateType.idleState)},s.initRoad=function(t){var e=1;t.length;for(e;e<t.length;e++)this.jijieDian=new Vector2D(t[e][0]+this.xoffset,t[e][1]+this.yoffset),this.posArr.push(this.jijieDian);this.fsm.changeState(stateType.moveState),this.ratioSoldY=this.minSoldRadius/this.maxSoldRadius},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e)},s.onDestroy=function(){t.prototype.onDestroy.call(this)},e}(PlayerBase);egret.registerClass(ShieldSoldier01,"ShieldSoldier01");var TowersBase=function(t){function e(){t.call(this),this.moveToTarget=!1,this.firstst="R",this.time=0,this.fireDelay=0,this.timesum=0,this.xoffset=0,this.yoffset=0,this.atjijie=!1,this.maxRadius=140,this.minRadius=100,this.voiceArr=["shield_fire1","shield_fire2","shield_fire3"],this.lifeBar=new LifeBar,this.addChild(this.lifeBar)}__extends(e,t);var i=__define,s=e,a=s.prototype;return a.playFireVoice=function(){Math.random()>.5?SoundManager.playEffect("arrow_fire1"):SoundManager.playEffect("arrow_fire2")},a.live=function(){this._hp<=0&&(this.canClear=!0),this._hp>this.life&&(this._hp=this.life)},i(a,"hp",function(){return this._hp},function(t){this._hp=t,this.live(),this.lifeBar.setProgress(this._hp,this.life)}),a.createYQ=function(){this.view.touchEnabled=!1},a.clearYQ=function(){null!=this.selectYQ&&(this.removeChild(this.selectYQ),this.selectYQ=null),this.view.touchEnabled=!0},a.onDestroy=function(){t.prototype.onDestroy.call(this),null!=this.target&&(this.target.target=null,this.target=null)},a.onEnterFrame=function(e){this.timesum+=e,t.prototype.onEnterFrame.call(this,e),this.canClear&&ObjectPool.getInstance().destroyObject(this);var i;for(this.atargets=[],i=0;i<this.targets.length;i++){var s=this.targets[i];if(null==s.target){var a=Utils.containsXY(s.x,s.y,this.sx,this.sy-22,this.maxRadius,this.ratioY),n=this.atargets.indexOf(s);a&&s.hp>0?-1==n&&this.atargets.push(s):-1!=n&&this.atargets.splice(n,1)}}for(i=0;i<this.targets.length;i++){var s=this.targets[i];if(null!=s.target){var a=Utils.containsXY(s.x,s.y,this.sx,this.sy-22,this.maxRadius,this.ratioY),n=this.atargets.indexOf(s);a&&s.hp>0?-1==n&&this.atargets.push(s):-1!=n&&this.atargets.splice(n,1)}}},a.isIdle=function(){return this.stateLabel="idle",!0},a.isMove=function(){return!0},a.isFighting=function(){return this.stateLabel="fighting",!0},a.isDead=function(){return this.stateLabel="dead",!0},e}(VectorElements);egret.registerClass(TowersBase,"TowersBase",["ILife"]);var Base=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.selectItem=function(){this.dispatchEvent(new TowerEvent(TowerEvent.SHOWTOOL,this))},s.deselectItem=function(){this.dispatchEvent(new TowerEvent(TowerEvent.HIDETOOL,this))},s.reselectItem=function(){this.dispatchEvent(new TowerEvent(TowerEvent.HIDETOOL,this)),Group.dispose()},e}(egret.Sprite);egret.registerClass(Base,"Base",["IGroupItem"]);var Base01=function(t){function e(){t.call(this),this.cacheAsBitmap=!0;var e=Utils.createBitmapByName("empty01");this.addChild(e),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onEnterFrame=function(t){},e}(Base);egret.registerClass(Base01,"Base01");var Base02=function(t){function e(){t.call(this),this.cacheAsBitmap=!0;var e=Utils.createBitmapByName("Base03");this.addChild(e),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onEnterFrame=function(t){},e}(Base);egret.registerClass(Base02,"Base02");var Base03=function(t){function e(){t.call(this),this.cacheAsBitmap=!0;var e=Utils.createBitmapByName("Base02");this.addChild(e),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onEnterFrame=function(t){},e}(Base);egret.registerClass(Base03,"Base03");var TowerBase=function(t){function e(){t.call(this),this.targets=[],this.buildID=1,this.maxRadius=140,this.minRadius=100}__extends(e,t);var i=(__define,e),s=i.prototype;return s.destory=function(){},s.init=function(){},s.onEnterFrame=function(t){},e}(Base);egret.registerClass(TowerBase,"TowerBase");var ShieldTowerBase=function(t){function e(){t.call(this),this.offArr=[[10,0],[0,-10],[-10,0]],this.offIdx=-1,this.createTime=1e4,this.timesum=0,this.voiceArr=["shield_ready1","shield_ready2","shield_ready3"];var e=Math.floor(3*Math.random());SoundManager.playEffect(this.voiceArr[e])}__extends(e,t);var i=(__define,e);i.prototype;return e}(TowerBase);egret.registerClass(ShieldTowerBase,"ShieldTowerBase");var Group=function(){function t(){}var e=(__define,t);e.prototype;return t.selectItem=function(e){if(t.selectedItem){if(t.selectedItem==e)return void t.selectedItem.reselectItem();t.selectedItem.deselectItem()}t.disposeIcon(),t.selectedItem=e,t.selectedItem&&(t.selectedItem.selectItem(),SoundManager.playEffect("select"))
},t.dispose=function(){t.selectedItem=null},t.selectIcon=function(e){if(t.selectedIcon){if(t.selectedIcon==e)return void t.selectedIcon.reselectIcon();t.selectedIcon.deselectIcon()}t.selectedIcon=e,t.selectedIcon&&(t.selectedIcon.selectIcon(),SoundManager.playEffect("select"))},t.disposeIcon=function(){null!=t.selectedIcon&&(t.selectedIcon.deselectIcon(),t.selectedIcon=null)},t}();egret.registerClass(Group,"Group");var HitTest=function(){function t(){}var e=(__define,t);e.prototype;return t.hitTestRect=function(t,e){var i=t.getBounds(),s=e.getBounds();return i.x=t.x,i.y=t.y,s.x=e.x,s.y=e.y,i.intersects(s)||s.intersects(i)},t.hitTestLayer=function(t,e){return Math.abs(t.x+t.width/2-(e.x+e.width/2))<=Math.abs((t.width+e.width)/2)&&Math.abs(t.y+t.height/2-(e.y+e.height/2))<=Math.abs((t.height+e.height)/2)},t.hitTestPoint=function(t){return!1},t}();egret.registerClass(HitTest,"HitTest");var LifeBar=function(t){function e(){t.call(this),this.bg=Utils.createBitmapByName("lifeBarBg"),this.addChild(this.bg),this.bar=Utils.createBitmapByName("lifeBar"),this.addChild(this.bar),this.bar.x=this.bar.y=1,this.cacheAsBitmap=!0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.setProgress=function(t,e){var i=18*t/e,s=0>i?0:i;this.bar.width=s},s.reSet=function(){this.bar.width=18},e}(egret.Sprite);egret.registerClass(LifeBar,"LifeBar");var ObjectPool=function(){function t(){this._isPause=!1,this._pool={},this._list=[],egret.Ticker.getInstance().register(this.onEnterFrame,this)}var e=(__define,t),i=e.prototype;return i.onEnterFrame=function(t){for(var e=this._list.concat(),i=0,s=e.length;s>i;i++){var a=e[i];a.onEnterFrame(t)}},i.pauseEnterFrame=function(){this._isPause=!0},i.resumeEnterFrame=function(){this._isPause=!1},i.createObject=function(t){var e,i=egret.getQualifiedClassName(t),s=this._pool[i];return e=null!=s&&s.length?s.shift():new t,e.onCreate(),this._list.push(e),e},i.destroyObject=function(t){var e=egret.getQualifiedClassName(t);if(null==this._pool[e]&&(this._pool[e]=[]),-1==this._pool[e].indexOf(t)&&this._pool[e].push(t),9==t.specialType)for(var i=0;i<t.targets.length;i++)Math.abs(t.targets[i].x-t.x)<70&&Math.abs(t.targets[i].y-t.y)<70&&(t.targets[i].hp-=t.damege);else if(10==t.specialType&&t.hp<=0){SoundManager.playEffect("roar_mp3");for(var s=GuankaBase.instance.enemy,i=0;i<s.length;i++)10==s[i].specialType&&s[i].hp>0&&(s[i].damage+=s[i].damage*s[i].value,s[i].suckBlood+=.1)}t.onDestroy();var a=this._list.indexOf(t);-1!=a&&this._list.splice(a,1)},i.destroyObjectByKey=function(t){for(var e=0;e<this._list.length;e++)this._list[e].key==t&&(this._list[e].onDestroy(),e--)},i.destroyAllObject=function(){for(;this._list.length;)this.destroyObject(this._list[0])},t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t}();egret.registerClass(ObjectPool,"ObjectPool");var SoundManager=function(){function t(){}var e=(__define,t);e.prototype;return t.playEffect=function(t,e){void 0===e&&(e=1);var i=RES.getRes(t);i.type=egret.Sound.EFFECT;var s=i.play(0,1);s.volume=e},t.playBgSound=function(t,e){void 0===e&&(e=!0),this.sdbg=RES.getRes(t),this.sdbg.type=egret.Sound.MUSIC,this.channelBG=this.sdbg.play(0,0),this.channelBG.volume=.3},t.stopBgSound=function(){this.channelBG.stop()},t}();egret.registerClass(SoundManager,"SoundManager");var Utils=function(){function t(){}var e=(__define,t);e.prototype;return t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.containsXY=function(t,e,i,s,a,n){void 0===n&&(n=.5);var h=t-i,r=e-s;return r/=n,Math.sqrt(h*h+r*r)<a?!0:!1},t.containsXY2=function(t,e){return t>40&&t<GameSetting.swid-80&&e>40&&e<GameSetting.shei-80?!0:!1},t.drawEllipse=function(t,e,i,s){void 0===s&&(s=!1);var a=new egret.Shape;return a.graphics.lineStyle(1,i),a.graphics.drawEllipse(0,0,t,e),a.graphics.endFill(),a},t.sortarr=function(t){for(var e,i=0;i<t.length;i++)for(var s=t.length-1;s>i;s--)t[s].y<t[s-1].y&&(e=t[s],t[s]=t[s-1],t[s-1]=e);return t},t}();egret.registerClass(Utils,"Utils");var Vector2D=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._x=t,this._y=e}var e=__define,i=t,s=i.prototype;return s.draw=function(t,e){void 0===e&&(e=0),t.lineStyle(0,e),t.moveTo(0,0),t.lineTo(this._x,this._y)},s.clone=function(){return new t(this.x,this.y)},s.zero=function(){return this._x=0,this._y=0,this},s.isZero=function(){return 0==this._x&&0==this._y},e(s,"length",function(){return Math.sqrt(this.lengthSQ)},function(t){var e=this.angle;this._x=Math.cos(e)*t,this._y=Math.sin(e)*t}),e(s,"lengthSQ",function(){return this._x*this._x+this._y*this._y}),e(s,"angle",function(){return Math.atan2(this._y,this._x)},function(t){var e=this.length;this._x=Math.cos(t)*e,this._y=Math.sin(t)*e}),s.normalize=function(){if(0==this.length)return this._x=1,this;var t=this.length;return this._x/=t,this._y/=t,this},s.truncate=function(t){return this.length=Math.min(t,this.length),this},s.reverse=function(){return this._x=-this._x,this._y=-this._y,this},s.isNormalized=function(){return 1==this.length},s.dotProd=function(t){return this._x*t.x+this._y*t.y},s.crossProd=function(t){return this._x*t.y-this._y*t.x},t.angleBetween=function(t,e){return t.isNormalized()||(t=t.clone().normalize()),e.isNormalized()||(e=e.clone().normalize()),Math.acos(t.dotProd(e))*(180/Math.PI)},s.sign=function(t){return this.perp.dotProd(t)<0?-1:1},e(s,"perp",function(){return new t(-this.y,this.x)}),s.dist=function(t){return Math.sqrt(this.distSQ(t))},s.distSQ=function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},s.add=function(e){return new t(this._x+e.x,this._y+e.y)},s.subtract=function(e){return new t(this._x-e.x,this._y-e.y)},s.multiply=function(e){return new t(this._x*e,this._y*e)},s.divide=function(e){return new t(this._x/e,this._y/e)},s.equals=function(t){return this._x==t.x&&this._y==t.y},e(s,"x",function(){return this._x},function(t){this._x=t}),e(s,"y",function(){return this._y},function(t){this._y=t}),s.tostring=function(){return"[Vector2D (x:"+this._x+", y:"+this._y+")]"},t}();egret.registerClass(Vector2D,"Vector2D");var ArrowBase=function(t){function e(){t.call(this),this.isHit=!1,this.isMiss=!1,this.follow=!1,this.t0=0,this.t1=20,this.g=1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.update=function(){this.follow&&(this.move(),this.hittest())},s.setTarget=function(t,e){this.pos=new egret.Point(t,e),this.xSpeed=(this.pos.x-this.p1.x)/this.t1,this.ySpeed=(this.pos.y-this.p1.y-this.g*this.t1*(this.t1/2))/this.t1},s.move=function(){this.setTarget(this.target.x,this.target.y-this.offy),this.t0+=.5,this.x=this.p1.x+this.t0*this.xSpeed,this.y=this.p1.y+this.t0*this.ySpeed+this.g*this.t0*this.t0/2,this.t0+=.5;var t=this.p1.x+this.t0*this.xSpeed,e=this.p1.y+this.t0*this.ySpeed+this.g*this.t0*this.t0/2;this.t0-=.5;var i=t-this.x,s=e-this.y;this.angel=Math.atan2(s,i),this.rotation=180*this.angel/Math.PI+180,this.angle=this.rotation},s.onEnterFrame=function(t){this.update(),this.isHit&&(this.view.gotoAndPlay("hit"),this.isHit=!1),this.isMiss&&(this.view.gotoAndPlay("miss"),this.isMiss=!1),("hitEnd"==this.view.currentLabel||"missEnd"==this.view.currentLabel)&&(this.canClear=!0),this.canClear&&ObjectPool.getInstance().destroyObject(this)},s.hittest=function(){if(!(this.angle>=0&&this.angle<=180)){var t=this.x-this.target.x<0?this.target.x-this.x:this.x-this.target.x,e=this.y-this.target.y-this.offy<0?this.target.y-this.offy-this.y:this.y-this.target.y-this.offy;if(1>=t&&1>=e){if(this.target.hp<=-this.damage){this.isMiss=!0,this.rotation=270;var i=2-4*Math.random(),s=6*Math.random()+4;this.x+=i,this.y+=s}else this.isHit=!0,Math.random()>.4?SoundManager.playEffect("arrow_hit2"):SoundManager.playEffect("arrow_hit1");this.follow=!1}}},e}(Elements);egret.registerClass(ArrowBase,"ArrowBase");var Arrow01=function(t){function e(){t.call(this),this.view=new egret.MovieClip,this.addChild(this.view),this.anchorOffsetY=this.height/2;var e=RES.getRes("Arrow01json"),i=RES.getRes("Arrow01png"),s=new egret.MovieClipDataFactory(e,i);this.view.movieClipData=s.generateMovieClipData("Arrow01"),this.damage=1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onCreate=function(){this.canClear=!1,this.isHit=!1,this.follow=!1,this.isMiss=!1,this.target=null,this.view.gotoAndStop(1),this.t0=0,this.xSpeed=0,this.ySpeed=0,this.pos=null},s.init=function(t,e,i){this.x=t.x,this.y=t.y,this.p1=t,this.target=e,this.offy=i,this.setTarget(this.target.x,this.target.y-this.offy),this.follow=!0},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e)},e}(ArrowBase);egret.registerClass(Arrow01,"Arrow01");var Arrow032=function(t){function e(){t.call(this),this.view=new egret.MovieClip,this.addChild(this.view),this.anchorOffsetY=this.height/2;var e=RES.getRes("Arrow032json"),i=RES.getRes("Arrow032png"),s=new egret.MovieClipDataFactory(e,i);this.view.movieClipData=s.generateMovieClipData("Arrow032"),this.damage=1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onCreate=function(){this.canClear=!1,this.isHit=!1,this.follow=!1,this.isMiss=!1,this.target=null,this.view.gotoAndStop(1),this.t0=0,this.xSpeed=0,this.ySpeed=0,this.pos=null},s.init=function(t,e,i){this.x=t.x,this.y=t.y,this.p1=t,this.target=e,this.offy=i,this.setTarget(this.target.x,this.target.y-this.offy),this.follow=!0},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e)},e}(ArrowBase);egret.registerClass(Arrow032,"Arrow032");var ExploBase=function(t){function e(){t.call(this),this.isHit=!1,this.isMiss=!1,this.follow=!1,this.maxSoldRadius=40,this.minSoldRadius=40,this.t0=0,this.t1=25,this.g=1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.update=function(){this.follow&&(this.move(),this.hittest())},s.setTarget=function(t,e){this.pos=new egret.Point(t,e),this.xSpeed=(this.pos.x-this.p1.x)/this.t1,this.ySpeed=(this.pos.y-this.p1.y-this.g*this.t1*(this.t1/2))/this.t1},s.move=function(){this.setTarget(this.target.x,this.target.y-this.offy),this.t0+=.5,this.x=this.p1.x+this.t0*this.xSpeed,this.y=this.p1.y+this.t0*this.ySpeed+this.g*this.t0*this.t0/2,this.t0+=.5;var t=this.p1.x+this.t0*this.xSpeed,e=this.p1.y+this.t0*this.ySpeed+this.g*this.t0*this.t0/2;this.t0-=.5;var i=t-this.x,s=e-this.y;this.angle=180*Math.atan2(s,i)/Math.PI+180},s.onEnterFrame=function(t){this.update(),this.isHit&&(this.view.gotoAndPlay("hit"),this.isHit=!1),"hitEnd"==this.view.currentLabel&&(this.canClear=!0),this.canClear&&ObjectPool.getInstance().destroyObject(this)},s.hittest=function(){if(!(this.angle>=0&&this.angle<=180)){var t=this.x-this.target.x<0?this.target.x-this.x:this.x-this.target.x,e=this.y-this.target.y-this.offy<0?this.target.y-this.offy-this.y:this.y-this.target.y-this.offy;if(1>=t&&1>=e){var i;for(this.atargets=[],i=0;i<this.targets.length;i++){var s=this.targets[i],a=Utils.containsXY(s.x,s.y,this.x,this.y,this.maxSoldRadius,this.ratioSoldY),n=this.atargets.indexOf(s);a&&s.hp>0?-1==n&&this.atargets.push(s):-1!=n&&this.atargets.splice(n,1)}for(i=0;i<this.atargets.length;i++){var s=this.atargets[i];s.hp-=this.damage}this.isHit=!0,this.follow=!1,SoundManager.playEffect("explo_fireend1")}}},e}(Elements);egret.registerClass(ExploBase,"ExploBase");var Explo031=function(t){function e(){t.call(this),this.ratioSoldY=this.minSoldRadius/this.maxSoldRadius,this.view=new egret.MovieClip,this.addChild(this.view),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height;var e=RES.getRes("Explo031json"),i=RES.getRes("Explo031png"),s=new egret.MovieClipDataFactory(e,i);this.view.movieClipData=s.generateMovieClipData("Explo03_1"),this.view.anchorOffsetX=this.view.width/2,this.view.x=this.view.width/2,this.view.anchorOffsetY=this.view.height,this.view.y=this.view.height,this.damage=1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onCreate=function(){this.canClear=!1,this.isHit=!1,this.follow=!1,this.isMiss=!1,this.target=null,this.view.gotoAndStop(1),this.t0=0,this.xSpeed=0,this.ySpeed=0,this.pos=null},s.init=function(t,e,i){this.x=t.x,this.y=t.y,this.p1=t,this.target=e,this.offy=0,this.setTarget(this.target.x,this.target.y-this.offy),this.follow=!0},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e)},e}(ExploBase);egret.registerClass(Explo031,"Explo031");var FireBallBase=function(t){function e(){t.call(this),this.isTravel=!1,this.isHit=!1,this.follow=!1,this.fsm=new StateMachine(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.update=function(){this.follow},s.idling=function(){this.curState!=stateType.idleState&&(this.curState=stateType.idleState)},s.moving=function(){this.curState!=stateType.moveState&&(this.curState=stateType.moveState)},s.movingEnd=function(){this.curState!=stateType.moveEndState&&(this.curState=stateType.moveEndState,this.fsm.changeState(stateType.idleState),this.hittest())},s.isIdle=function(){return!0},s.isMove=function(){return!0},s.setPosArr=function(){this._pathIndex=0,this.posArr.length=0;var t=new Vector2D(this.p1.x,this.p1.y);this.posArr.push(t),this.fsm.changeState(stateType.moveState)},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e),this.fsm.onEnterFrame(e),this.update(),this.isTravel&&(this.view.gotoAndPlay("travel"),this.isTravel=!1),this.isHit&&(this.view.gotoAndPlay("hit"),this.isHit=!1),"hitEnd"==this.view.currentLabel&&(this.canClear=!0),"travelEnd"==this.view.currentLabel&&this.view.gotoAndPlay("travel"),this.canClear&&ObjectPool.getInstance().destroyObject(this)},s.hittest=function(){var t=this.x-this.p1.x<0?this.p1.x-this.x:this.x-this.p1.x,e=this.y-this.p1.y<0?this.p1.y-this.y:this.y-this.p1.y;if(1>=t&&1>=e){var i;for(this.atargets=[],i=0;i<this.targets.length;i++){var s=this.targets[i],a=Utils.containsXY(s.x,s.y,this.x,this.y,this.maxSoldRadius,this.ratioSoldY),n=this.atargets.indexOf(s);a&&s.hp>0?-1==n&&this.atargets.push(s):-1!=n&&this.atargets.splice(n,1)}for(i=0;i<this.atargets.length;i++){var s=this.atargets[i];s.hp-=this.damage}this.isHit=!0}},e}(VectorElements);egret.registerClass(FireBallBase,"FireBallBase");var FireBall=function(t){function e(){t.call(this),this.ratioSoldY=this.minSoldRadius/this.maxSoldRadius,this.view=new egret.MovieClip,this.addChild(this.view),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height;var e=RES.getRes("stone1json"),i=RES.getRes("stone1png"),s=new egret.MovieClipDataFactory(e,i);this.view.movieClipData=s.generateMovieClipData("stone1"),this.view.anchorOffsetX=this.view.width/2,this.view.x=this.view.width/2}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onCreate=function(){this.canClear=!1,this.isHit=!1,this.follow=!1,this.isTravel=!0,this._maxSpeed=5,this.fsm.changeState(stateType.idleState),this.curState=stateType.idleState},s.init=function(t,e){this.p1=new egret.Point(t,e),this._position.x=this.x=t,this._position.y=this.y=e-480,this.setPosArr()},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e)},e}(FireBallBase);egret.registerClass(FireBall,"FireBall");var MagicBulletBase=function(t){function e(){t.call(this),this.isTravel=!1,this.isHit=!1,this.follow=!1,this.fsm=new StateMachine(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.update=function(){this.follow},s.idling=function(){this.curState!=stateType.idleState&&(this.curState=stateType.idleState)},s.moving=function(){this.curState!=stateType.moveState&&(this.curState=stateType.moveState),this.setPosArr()},s.movingEnd=function(){this.curState!=stateType.moveEndState&&(this.curState=stateType.moveEndState,this.fsm.changeState(stateType.idleState),this.hittest())},s.isIdle=function(){return!0},s.isMove=function(){return!0},s.setPosArr=function(){this._pathIndex=0,this.posArr.length=0;var t=new Vector2D(this.target.x,this.target.y-this.target.offy);this.posArr.push(t),this.fsm.changeState(stateType.moveState)},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e),this.rotation=this._angle,this.fsm.onEnterFrame(e),this.update(),this.isTravel&&(this.view.gotoAndPlay("travel"),this.isTravel=!1),this.isHit&&(this.view.gotoAndPlay("hit"),this.isHit=!1),"hitEnd"==this.view.currentLabel&&(this.canClear=!0),"travelEnd"==this.view.currentLabel&&this.view.gotoAndPlay("travel"),this.canClear&&ObjectPool.getInstance().destroyObject(this)},s.hittest=function(){var t=this.x-this.target.x<0?this.target.x-this.x:this.x-this.target.x,e=this.y-this.target.y-this.target.offy<0?this.target.y-this.target.offy-this.y:this.y-this.target.y-this.target.offy;4>=t&&4>=e&&HitTest.hitTestRect(this,this.target)&&(this.isHit=!0,this.follow=!1)},e}(VectorElements);egret.registerClass(MagicBulletBase,"MagicBulletBase");var MagicBullet010203=function(t){function e(){t.call(this),this.view=new egret.MovieClip,this.addChild(this.view),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2;var e=RES.getRes("MagicBullet010203json"),i=RES.getRes("MagicBullet010203png"),s=new egret.MovieClipDataFactory(e,i);this.view.movieClipData=s.generateMovieClipData("MagicBullet010203")}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onCreate=function(){this.canClear=!1,this.isHit=!1,this.follow=!1,this.isTravel=!0,this.target=null,this._maxSpeed=2,this.fsm.changeState(stateType.idleState),this.curState=stateType.idleState},s.init=function(t,e,i){this.target=i,this._position.x=this.x=e.x,this._position.y=this.y=e.y,this.unit=t,this.setPosArr()},s.onEnterFrame=function(e){t.prototype.onEnterFrame.call(this,e)},e}(MagicBulletBase);egret.registerClass(MagicBullet010203,"MagicBullet010203");var World=function(t){function e(){t.call(this),SoundManager.playBgSound("mapbgsound"),this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.bg=Utils.createBitmapByName("map"),this.bg.anchorOffsetY=.2*this.bg.height,this.addChild(this.bg),this.flagArr=[];for(var t,e=GuanKaConfig.getData(),i=e.length,s=0;i>s;s++){var a=e[s].ispass,n=a?"flag0":"flag1";if(t=Utils.createBitmapByName(n),t.x=e[s].xpos,t.y=e[s].ypos,t.alpha=0,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.choseGuanka,this),this.addChild(t),this.flagArr.push(t),!a)break;var h=this;TweenMax.delayedCall(1.5,function(){h.loadGuanka()})}for(var s=0;s<this.flagArr.length;s++)TweenMax.fromTo(this.flagArr[s],.3,{alpha:0,y:this.flagArr[s].y-30},{alpha:1,y:this.flagArr[s].y,delay:.1*s+1});for(var s=0;30>s;s++)for(var r=0;30>r;r++)this.addTupian(10*s,10*r)},s.addTupian=function(t,e){var i=new egret.Bitmap;i=Utils.createBitmapByName("lock"),i.x=t,i.y=e,this.addChild(i)},s.removeLis=function(){for(var t,e,t=0;t<this.flagArr.length;t++)e=this.flagArr[t],e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.choseGuanka,this)},s.addLis=function(){for(var t,e,t=0;t<this.flagArr.length;t++)e=this.flagArr[t],e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.choseGuanka,this)},s.showXZ=function(){this.xzmb=new egret.Sprite,this.xzmb.x=egret.MainContext.instance.stage.stageWidth/2,this.xzmb.y=egret.MainContext.instance.stage.stageHeight/2-60,this.addChild(this.xzmb),this.xzmb.scaleX=this.xzmb.scaleY=.1,this.gkxz=Utils.createBitmapByName("select_png"),this.xzmb.addChild(this.gkxz),this.gushi=Utils.createBitmapByName("button_png"),this.gushi.x=45,this.gushi.y=250,this.xzmb.addChild(this.gushi),this.xzmb.anchorOffsetX=this.xzmb.width/2,this.xzmb.anchorOffsetY=this.xzmb.height/2,this.gktxt=new egret.TextField,this.gktxt.text=GuanKaConfig.data[Main.curIdx].name.toString(),this.gktxt.fontFamily="Microsoft YaHei",this.gktxt.textColor=16776960,this.gktxt.strokeColor=0,this.gktxt.size=25,this.gktxt.stroke=1,this.gktxt.x=70,this.gktxt.y=5,this.xzmb.addChild(this.gktxt),this.gkStory=new egret.TextField,this.gkStory.text=GuanKaConfig.data[Main.curIdx].story.toString(),this.gkStory.size=15,this.gkStory.textColor=0,this.gkStory.width=200,this.gkStory.fontFamily="Microsoft YaHei",this.gkStory.x=20,this.gkStory.y=160,this.xzmb.addChild(this.gkStory),this.txt=new egret.TextField,this.txt.text="准备游戏",this.txt.size=25,this.txt.fontFamily="Microsoft YaHei",this.txt.x=70,this.txt.y=260,this.xzmb.addChild(this.txt),this.bg.touchEnabled=!0,this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.closeHandle,this),this.gushi.touchEnabled=!0,this.gushi.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.gushiHandle,this),TweenMax.to(this.xzmb,.3,{scaleX:1,scaleY:1,ease:Back.easeOut})},s.gushiHandle=function(t){this.closeHandle(null),this.zbmb=new egret.Sprite,this.zbmb.x=egret.MainContext.instance.stage.stageWidth/2,this.zbmb.y=egret.MainContext.instance.stage.stageHeight/2-70,this.addChild(this.zbmb),this.zbmb.scaleX=this.zbmb.scaleY=.1,this.gkzb=Utils.createBitmapByName("yubei_png"),this.zbmb.addChild(this.gkzb),this.start=Utils.createBitmapByName("button_png"),this.start.x=150,this.start.y=320,this.zbmb.addChild(this.start),TweenMax.to(this.zbmb,.5,{scaleX:.9,scaleY:.9,ease:Back.easeOut}),this.txt=new egret.TextField,this.txt.text="开始游戏",this.txt.size=25,this.txt.fontFamily="Microsoft YaHei",this.txt.x=175,this.txt.y=330,this.zbmb.addChild(this.txt),this.zbmb.anchorOffsetX=this.zbmb.width/2,this.zbmb.anchorOffsetY=this.zbmb.height/2,this["float"]=new egret.TextField,this["float"].anchorOffsetX=this["float"].width/2,this["float"].alpha=0,this["float"].size=20,this["float"].text="暂时无法选择出战的兵种",this["float"].textColor=16776960,this["float"].x=200,this["float"].y=300,this["float"].fontFamily="Microsoft YaHei",this.addChild(this["float"]),this.zbmb.touchEnabled=!0,this.zbmb.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.floatTxt,this),this.start.touchEnabled=!0,this.start.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.kaishiHandle,this)},s.kaishiHandle=function(t){Main.wujin=!1,this.loadGuanka()},s.floatTxt=function(t){this.zbmb.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.floatTxt,this),this["float"].alpha=1,this["float"].x=t.localX,this["float"].y=t.localY+100;var e=this;TweenMax.to(this["float"],1,{y:this["float"].y-50,alpha:0,onComplete:function(){e.zbmb.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.floatTxt,e)}})},s.closeHandle=function(t){this.gushi.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.gushiHandle,this);var e=this;null!=this.xzmb&&TweenMax.to(this.xzmb,.3,{scaleX:.1,scaleY:.1,ease:Back.easeIn,onComplete:function(){e.removeChild(e.xzmb),e.xzmb=null,e.addLis()}}),null!=this.zbmb&&(this.zbmb.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.floatTxt,this),this.start.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.kaishiHandle,this),TweenMax.to(this.zbmb,.3,{scaleX:.1,scaleY:.1,ease:Back.easeIn,onComplete:function(){e.removeChild(e.zbmb),e.zbmb=null,e.addLis()}}))},s.choseGuanka=function(t){Main.curIdx=this.flagArr.indexOf(t.currentTarget),this.removeLis(),this.showXZ()},s.loadGuanka=function(){Main.loadCommis1st?(console.log("加载UI资源"),Main.instance.dispatchEvent(new MainEvent(MainEvent.OPENLOADBAR,"uiLoad")),Main.loadCommis1st=!1):(console.log("加载关卡资源"),Main.instance.dispatchEvent(new MainEvent(MainEvent.OPENLOADBAR,GuanKaConfig.guankaData[Main.curIdx]))),SoundManager.stopBgSound()},s.backH=function(t){Main.instance.dispatchEvent(new MainEvent(MainEvent.OPENLOADBAR,"welcomeload")),SoundManager.stopBgSound()},s.openHeroH=function(t){},s.destroy=function(){RES.destroyRes("map"),TweenMax.killChildTweensOf(this);for(var t=0;t<this.flagArr.length;t++)this.flagArr[t].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.choseGuanka,this)},e}(egret.Sprite);egret.registerClass(World,"World");